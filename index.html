<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление данными</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* ПЕРЕМЕННЫЕ ДЛЯ ТЕМЫ */
        :root {
            --bg-primary: #2f2f2f;
            --bg-secondary: #252525;
            --bg-tertiary: #4a4a4a;
            --bg-dark-controls: #1a1a1a;
            --accent-color: #e67e22;
            --accent-hover: #d35400;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --border-color: #4a4a4a;
            --table-bg: #3a3a3a;
            --table-border: #4a4a4a;
            --table-header-bg: #1a1a1a;
            --table-hover: #5a5a5a;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        #login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
        }

        .login-container {
            background: var(--bg-secondary);
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 420px;
            border: 1px solid var(--border-color);
        }

        .login-container h2 {
            margin-bottom: 1.8rem;
            text-align: center;
            color: var(--text-primary);
            font-size: 1.8rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.6rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.9rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(230, 126, 34, 0.2);
        }

        button {
            padding: 0.9rem 1.5rem;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        button:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
        }

        #main-screen {
            display: none;
            height: 100vh;
            flex-direction: column;
            background: var(--bg-primary);
        }

        .header {
            background: var(--bg-secondary);
            padding: 0.8rem 1.5rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            border-bottom: 1px solid var(--border-color);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            height: 40px;
            opacity: 0.9;
            cursor: pointer;
            border-radius: 6px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-name {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .user-role-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }

        #logout-btn.user-role-btn {
            cursor: pointer;
            background: var(--accent-color);
        }

        #logout-btn.user-role-btn:hover {
            background: var(--accent-hover);
        }

        .top-controls-panel {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: nowrap;
            height: 65px;
            min-height: 65px;
        }

        .tabs-wrapper {
            display: flex;
            align-items: center;
            flex: 0 1 auto;
            position: relative;
            height: 40px;
            max-width: 60%;
            min-width: 200px;
        }

        .tabs-scroll-btn {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            z-index: 2;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .tabs-scroll-btn:hover {
            background: var(--table-hover);
        }

        .tabs-scroll-btn.left {
            margin-right: 5px;
        }

        .tabs-scroll-btn.right {
            margin-left: 5px;
        }

        .tabs-container {
            display: flex;
            align-items: center;
            gap: 8px;
            height: 40px;
            overflow-x: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
            scroll-behavior: smooth;
            flex: 1;
        }

        .tabs-container::-webkit-scrollbar {
            display: none;
        }

        .tab {
            background: var(--bg-tertiary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid var(--table-hover);
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            min-width: 140px;
            height: 40px;
            flex-shrink: 0;
            text-align: center;
        }

        .tab.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .tab.editable {
            cursor: text;
            border: 1px dashed transparent;
        }

        .tab.editable:hover {
            border-color: var(--accent-color);
            background: var(--bg-secondary);
        }

        .tab.editable:focus {
            outline: none;
            border-color: var(--accent-color);
            background: var(--bg-primary);
            box-shadow: 0 0 0 2px rgba(230, 126, 34, 0.2);
        }

        .tab-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            font-size: 14px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .tab-close:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        .controls-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: auto;
            flex-shrink: 0;
            flex-wrap: nowrap;
            min-width: 40%;
            justify-content: flex-end;
        }

        .new-tab-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.9rem;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            text-align: center;
        }

        .new-tab-btn:hover {
            background: var(--accent-hover);
        }

        .search-container {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-dark-controls);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 6px 12px;
            min-width: 240px;
            height: 40px;
            flex-shrink: 0;
        }

        .search-input {
            border: none;
            outline: none;
            flex: 1;
            padding: 6px;
            font-size: 0.9rem;
            background: transparent;
            color: var(--text-primary);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-clear {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 4px 6px;
            font-size: 0.8rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .search-clear:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        /* ИСПРАВЛЕННЫЕ СТИЛИ КНОПОК - ТЕМНО-СЕРЫЙ ЦВЕТ */
        .filter-selected-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.9rem;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .filter-selected-btn:hover {
            background: var(--table-hover);
        }

        .export-excel-btn {
            background: var(--bg-dark-controls);
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.9rem;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .export-excel-btn:hover {
            background: var(--table-hover);
        }

        .import-excel-btn {
            background: var(--bg-dark-controls);
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.9rem;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .import-excel-btn:hover {
            background: var(--table-hover);
        }

        .container {
            display: flex;
            height: calc(100vh - 135px);
        }

        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            color: white;
            padding: 1.2rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .sidebar-buttons {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
        }

        .sidebar-buttons::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-buttons::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 3px;
        }

        .sidebar-buttons::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }

        .sidebar-buttons::-webkit-scrollbar-thumb:hover {
            background: var(--table-hover);
        }

        .sidebar-bottom {
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            padding-top: 1.2rem;
        }

        /* ИСПРАВЛЕННЫЕ СТИЛИ ДЛЯ ВЫРАВНИВАНИЯ КНОПОК ПО ЦЕНТРУ И РАССТОЯНИЯ МЕЖДУ НИМИ */
        .sidebar button {
            margin-bottom: 4px;
            background: var(--bg-tertiary);
            width: 100%;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-align: center;
            padding: 0 15px;
        }

        /* ОБЩАЯ АНИМАЦИЯ ДЛЯ ВСЕХ КНОПОК В САЙДБАРЕ */
        .sidebar button:hover {
            background: var(--accent-color);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
        }

        .custom-button-wrapper {
            margin-bottom: 4px;
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .custom-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 8px;
            color: white;
            flex: 1;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .custom-button:hover {
            background: var(--accent-color);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
        }

        .button-text {
            flex: 1;
            text-align: center;
            padding: 0 12px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .button-actions {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .btn-edit-small {
            background: var(--bg-tertiary);
            padding: 0.3rem 0.6rem;
            font-size: 0.8rem;
            border-radius: 5px;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            height: 40px;
            width: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-edit-small:hover {
            background: var(--table-hover);
        }

        .btn-danger-small {
            background: var(--bg-tertiary);
            padding: 0.3rem 0.6rem;
            font-size: 0.8rem;
            border-radius: 5px;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            height: 40px;
            width: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-danger-small:hover {
            background: var(--table-hover);
        }

        /* СЕКТОР ТАБЛИЦЫ ТЕМНЫЙ */
        .content {
            flex: 1;
            padding: 1.2rem;
            overflow: auto;
            position: relative;
            background: var(--bg-secondary);
        }

        .table-container {
            position: relative;
            overflow: auto;
            height: 100%;
            background: var(--table-bg);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            border: 1px solid var(--table-border);
        }

        .table-container::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .table-container::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 5px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 5px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: var(--table-hover);
        }

        .table-container {
            scrollbar-width: thin;
            scrollbar-color: var(--bg-tertiary) var(--bg-primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--table-bg);
        }

        th, td {
            border: 1px solid var(--table-border);
            padding: 0.4rem;
            text-align: center;
            position: relative;
            color: var(--text-primary);
            font-size: 0.85rem;
        }

        /* ИСПРАВЛЕННЫЕ СТИЛИ ЗАГОЛОВКОВ - ТЕМНЕЕ И С ВИДИМЫМИ ГРАНИЦАМИ */
        th {
            background: var(--table-header-bg);
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
            padding: 8px 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
            border: 1px solid #333 !important;
        }

        th:first-child {
            min-width: 50px;
            max-width: 60px;
            width: 50px;
        }

        th:nth-child(2) {
            min-width: 70px;
            max-width: 80px;
            width: 70px;
        }

        th:last-child {
            min-width: 40px;
            max-width: 50px;
            width: 40px;
        }

        th.actions-header {
            background: var(--table-header-bg);
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 8px 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-secondary);
            border: 1px solid #333 !important;
        }

        th.actions-header .th-title {
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: bold;
        }

        th.editable-header:hover {
            background: var(--table-hover);
        }

        tr:hover {
            background: var(--table-hover);
        }

        .editable {
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }

        .editable:hover {
            background-color: var(--table-hover);
        }

        .row-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .select-all-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .delete-row-btn {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: none;
            border-radius: 5px;
            padding: 4px 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            text-align: center;
        }

        .delete-row-btn:hover {
            background: var(--table-hover);
            color: var(--text-primary);
        }

        .date-cell-warning {
            background-color: rgba(230, 126, 34, 0.2) !important;
            border: 1px solid var(--accent-color) !important;
            color: var(--text-primary) !important;
        }

        .date-cell-danger {
            background-color: rgba(230, 126, 34, 0.4) !important;
            border: 1px solid var(--accent-hover) !important;
            color: var(--text-primary) !important;
        }

        .date-cell-normal {
            background-color: var(--bg-tertiary) !important;
            border: 1px solid var(--table-border) !important;
            color: var(--text-primary) !important;
        }

        .date-picker {
            position: fixed;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 10000;
            min-width: 280px;
            color: var(--text-primary);
        }

        .date-picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 6px;
        }

        .month-nav-btn {
            background: var(--bg-tertiary);
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 5px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .month-nav-btn:hover {
            background: var(--accent-color) !important;
            color: white;
        }

        .date-picker-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }

        .date-picker-day {
            padding: 10px 6px;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .date-picker-day:hover {
            background: var(--accent-color) !important;
            color: white;
        }

        .date-picker-day.selected {
            background: var(--accent-color);
            color: white;
        }

        .date-picker-day.today {
            background: var(--bg-tertiary);
            font-weight: bold;
        }

        .notification-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 420px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 10000;
            max-height: 80vh;
            overflow-y: auto;
        }

        .notification-header {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 14px 18px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-content {
            padding: 18px;
        }

        .notification-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid var(--bg-tertiary);
            background: var(--bg-primary);
        }

        .notification-item.warning {
            border-left-color: var(--accent-color);
            background: rgba(230, 126, 34, 0.2);
        }

        .notification-item.danger {
            border-left-color: var(--accent-hover);
            background: rgba(211, 84, 0, 0.3);
        }

        .close-notifications {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .close-notifications:hover {
            background: rgba(255,255,255,0.2);
        }

        .cell-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 20px;
        }

        .cell-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 0 4px;
        }

        .file-icons {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .file-icon-small {
            width: 20px;
            height: 20px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-tertiary);
            border: 1px solid var(--table-border);
            color: var(--text-secondary);
            text-align: center;
        }

        .file-icon-small:hover {
            background: var(--table-hover);
            color: var(--text-primary);
        }

        .th-content {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .th-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 20px;
        }

        .th-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 2px 4px;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-primary);
            text-align: center;
        }

        .filter-controls {
            display: flex;
            align-items: center;
            gap: 3px;
            flex-shrink: 0;
        }

        .sort-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 3px;
            border-radius: 3px;
            color: var(--text-secondary);
            font-size: 13px;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .sort-btn:hover {
            background: var(--table-hover);
            color: var(--text-primary);
        }

        .filter-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 3px;
            border-radius: 3px;
            color: var(--text-secondary);
            font-size: 13px;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background: var(--table-hover);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--table-hover);
            color: var(--text-primary);
        }

        .filter-btn.filtered {
            color: var(--accent-color);
        }

        .filter-dropdown {
            position: fixed;
            top: 0;
            left: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 10000;
            min-width: 240px;
            max-width: 320px;
            max-height: 420px;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
            font-size: 14px;
            color: var(--text-primary);
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .filter-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-secondary);
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            transition: all 0.2s ease;
        }

        .filter-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .filter-search {
            width: 100%;
            padding: 8px 10px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 13px;
            outline: none;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .filter-search:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(230, 126, 34, 0.2);
        }

        .filter-search::placeholder {
            color: var(--text-secondary);
        }

        .filter-options {
            max-height: 220px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 10px;
            background: var(--bg-primary);
        }

        .filter-options::-webkit-scrollbar {
            width: 8px;
        }

        .filter-options::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .filter-options::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .filter-options::-webkit-scrollbar-thumb:hover {
            background: var(--table-hover);
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            font-size: 13px;
            cursor: pointer;
            transition: background-color 0.1s;
            border-bottom: 1px solid var(--bg-secondary);
        }

        .filter-option:hover {
            background-color: var(--bg-tertiary);
        }

        .filter-option input[type="checkbox"] {
            margin: 0;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .filter-option label {
            cursor: pointer;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .filter-actions {
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }

        .filter-actions button {
            flex: 1;
            padding: 8px 12px;
            font-size: 13px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            height: 36px;
            text-align: center;
        }

        .filter-actions button:hover {
            background: var(--table-hover);
            border-color: var(--table-hover);
        }

        .filter-actions .btn-primary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }

        .filter-actions .btn-primary:hover {
            background: var(--table-hover);
            border-color: var(--table-hover);
        }

        .filter-count {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .sort-indicator {
            margin-left: 4px;
            font-size: 11px;
        }

        .sort-asc .sort-indicator::after {
            content: "↑";
        }

        .sort-desc .sort-indicator::after {
            content: "↓";
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 2.5rem;
            border-radius: 12px;
            width: 90%;
            max-width: 850px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.8rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close {
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .close:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 1.2rem;
        }

        .form-row input {
            flex: 1;
            padding: 0.9rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .admin-only {
            display: none;
        }

        .admin .admin-only {
            display: block;
        }

        .user-only {
            display: block;
        }

        .admin .user-only {
            display: none;
        }

        .user-list {
            margin-top: 1.2rem;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 0.8rem;
            background: var(--bg-primary);
        }

        .user-actions {
            display: flex;
            gap: 6px;
        }

        .btn-danger {
            background: var(--bg-tertiary);
        }

        .btn-danger:hover {
            background: var(--table-hover);
        }

        .btn-edit {
            background: var(--bg-tertiary);
        }

        .btn-edit:hover {
            background: var(--table-hover);
        }

        .file-upload-area {
            border: 2px dashed var(--border-color);
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            background: var(--bg-primary);
        }

        .file-upload-area:hover {
            border-color: var(--accent-color);
            background: var(--bg-secondary);
        }

        .attached-files {
            margin-top: 1.2rem;
        }

        .attached-file {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: var(--bg-primary);
            border-radius: 6px;
            margin-bottom: 0.6rem;
            border: 1px solid var(--border-color);
        }

        .edit-cell-content {
            min-height: 120px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.9rem;
            margin-bottom: 1.2rem;
            width: 100%;
            resize: vertical;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: inherit;
        }

        .preview-content {
            text-align: center;
            margin: 1.2rem 0;
        }

        .preview-image {
            max-width: 100%;
            max-height: 450px;
            border-radius: 8px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .preview-document {
            width: 100%;
            height: 550px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .preview-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 1.2rem;
        }

        .preview-actions button {
            padding: 0.8rem 1.5rem;
        }

        .btn-success {
            background: var(--bg-tertiary);
        }

        .btn-success:hover {
            background: var(--table-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
        }

        .btn-secondary:hover {
            background: var(--table-hover);
        }

        .file-info {
            text-align: center;
            margin-bottom: 1.2rem;
            padding: 1.2rem;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        /* СТИЛИ ДЛЯ МАЛЕНЬКОЙ КНОПКИ ДОБАВИТЬ СТРОКУ У ПОЛЬЗОВАТЕЛЯ */
        #add-row-btn {
            position: fixed;
            left: 5px;
            bottom: 5px;
            width: 1px !important;
            height: 1px !important;
            min-width: 1px !important;
            min-height: 1px !important;
            padding: 0 !important;
            margin: 0 !important;
            font-size: 0 !important;
            opacity: 0.1;
            z-index: 9999;
            overflow: hidden;
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
        }

        .admin #add-row-btn {
            position: static;
            width: 100% !important;
            height: 40px !important;
            min-width: auto !important;
            min-height: auto !important;
            padding: 0.9rem 1.5rem !important;
            margin-bottom: 4px !important;
            font-size: 1rem !important;
            opacity: 1;
            background: var(--accent-color) !important;
        }

        .admin #add-row-btn:hover {
            background: var(--accent-hover) !important;
        }

        .add-row-btn {
            background: var(--accent-color) !important;
        }

        .add-row-btn:hover {
            background: var(--accent-hover) !important;
        }

        .check-dates-btn {
            background: var(--accent-color) !important;
        }

        .check-dates-btn:hover {
            background: var(--accent-hover) !important;
        }

        .manage-users-btn {
            background: var(--accent-color) !important;
        }

        .manage-users-btn:hover {
            background: var(--accent-hover) !important;
        }

        .add-custom-button-btn {
            background: var(--accent-color) !important;
        }

        .add-custom-button-btn:hover {
            background: var(--accent-hover) !important;
        }

        .date-input-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            padding: 0 8px;
            z-index: 100;
            border-radius: 4px;
        }

        .date-input {
            width: 100%;
            border: 2px solid var(--accent-color);
            border-radius: 5px;
            padding: 6px 8px;
            font-size: 14px;
            outline: none;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .header-title {
            cursor: default;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-title.editable {
            cursor: text;
            border: 1px dashed transparent;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .header-title.editable:hover {
            border-color: var(--accent-color);
            background: var(--bg-secondary);
        }

        .header-title.editable:focus {
            outline: none;
            border-color: var(--accent-color);
            background: var(--bg-primary);
            box-shadow: 0 0 0 3px rgba(230, 126, 34, 0.2);
        }

        .icon {
            font-size: 1.1em;
            color: var(--text-primary);
        }

        .column-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 4px;
            z-index: 1000;
        }

        .column-control-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            font-size: 12px;
            opacity: 0.3;
        }

        .column-control-btn:hover {
            background: var(--bg-tertiary);
            opacity: 0.7;
        }

        /* НОВЫЕ СТИЛИ ДЛЯ КНОПОК УПРАВЛЕНИЯ СТОЛБЦАМИ У ПОЛЬЗОВАТЕЛЕЙ */
        body:not(.admin) .column-controls {
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 1000;
        }

        body:not(.admin) .column-control-btn {
            width: 1px;
            height: 1px;
            opacity: 0.01;
            position: absolute;
            bottom: 0;
            right: 0;
            overflow: hidden;
            pointer-events: auto;
        }

        body:not(.admin) .column-control-btn:hover {
            background: transparent;
            opacity: 0.01;
        }

        .fixed-columns-setting {
            position: fixed;
            bottom: 60px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            z-index: 1000;
            color: var(--text-primary);
            font-size: 12px;
        }

        .fixed-columns-setting input {
            width: 50px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 4px;
            border-radius: 3px;
            margin-left: 8px;
        }

        /* СТИЛИ ДЛЯ СИНХРОНИЗАЦИИ */
        .sync-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10000;
            display: none;
        }

        .sync-status.success {
            background: #4CAF50;
            color: white;
            display: block;
        }

        .sync-status.error {
            background: #f44336;
            color: white;
            display: block;
        }

        .sync-status.warning {
            background: #ff9800;
            color: white;
            display: block;
        }

        .sync-status.info {
            background: #2196F3;
            color: white;
            display: block;
        }

        .github-sync-btn {
            background: var(--accent-color) !important;
        }

        .github-sync-btn:hover {
            background: var(--accent-hover) !important;
        }

        /* УБРАНЫ СТИЛИ ДЛЯ ТЕМ И КНОПКИ ТЕМ */

        @media (max-width: 1200px) {
            .top-controls-panel {
                height: auto;
                padding: 15px;
            }
            
            .controls-group {
                flex-wrap: wrap;
                justify-content: flex-end;
            }
            
            .search-container {
                min-width: 200px;
            }
        }

        @media (max-width: 992px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
                order: 2;
            }
            
            .content {
                order: 1;
                flex: none;
                height: 60vh;
            }
            
            .top-controls-panel {
                flex-direction: column;
                height: auto;
                gap: 10px;
                padding: 10px;
            }
            
            .tabs-wrapper {
                max-width: 100%;
                width: 100%;
            }
            
            .controls-group {
                width: 100%;
                justify-content: space-between;
                margin-left: 0;
            }
            
            .search-container {
                min-width: 150px;
                flex: 1;
            }
            
            .header {
                flex-direction: column;
                height: auto;
                padding: 10px;
                gap: 10px;
            }
            
            .header-content {
                justify-content: center;
                width: 100%;
            }
            
            .user-info {
                justify-content: center;
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                max-height: 250px;
            }
            
            .content {
                height: 50vh;
            }
            
            .controls-group {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .search-container {
                order: -1;
                width: 100%;
            }
            
            .tabs-container {
                max-width: 100%;
            }
            
            .tab {
                min-width: 120px;
                padding: 6px 12px;
            }
            
            .modal-content {
                padding: 1.5rem;
                width: 95%;
            }
            
            .notification-panel {
                width: 95%;
                right: 2.5%;
            }
        }

        @media (max-width: 576px) {
            .login-container {
                padding: 1.5rem;
                margin: 10px;
            }
            
            .sidebar {
                padding: 1rem;
            }
            
            .content {
                padding: 0.8rem;
            }
            
            .top-controls-panel {
                padding: 8px;
            }
            
            .controls-group {
                flex-direction: column;
                gap: 5px;
            }
            
            .controls-group button {
                width: 100%;
                justify-content: center;
            }
            
            .tabs-wrapper {
                flex-direction: column;
                height: auto;
                gap: 5px;
            }
            
            .tabs-container {
                order: 2;
                height: 35px;
            }
            
            .tabs-scroll-btn.left {
                margin-right: 0;
            }
            
            .header-title {
                font-size: 1.2rem;
            }
            
            .user-role-btn {
                min-width: 100px;
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 0.3rem;
                font-size: 0.8rem;
            }
            
            th {
                padding: 6px 4px;
                font-size: 0.8rem;
            }
            
            .column-controls {
                bottom: 10px;
                right: 10px;
            }
            
            .fixed-columns-setting {
                bottom: 50px;
                right: 10px;
            }
        }

        @media (max-width: 400px) {
            .sidebar button {
                font-size: 0.8rem;
                padding: 0 10px;
            }
            
            .button-text {
                font-size: 0.8rem;
            }
            
            .custom-button-wrapper {
                flex-direction: column;
                gap: 2px;
            }
            
            .button-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }

        /* ДОБАВЛЕННЫЙ ОТСТУП МЕЖДУ КНОПКОЙ "ОТОБРАЗИТЬ ВСЕ" И СЛЕДУЮЩЕЙ */
        #show-all {
            margin-bottom: 10px !important;
        }
    </style>
</head>
<body class="theme-orange">
    <!-- Экран входа -->
    <div id="login-screen">
        <div class="login-container">
            <h2>Вход в систему</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Имя пользователя</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Пароль</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit">Войти</button>
            </form>
        </div>
    </div>

    <!-- Основной экран -->
    <div id="main-screen">
        <div class="header">
            <div class="header-content">
                <img id="header-logo" class="logo" src="" alt="Logo" style="display: none;">
                <h1 id="header-title" class="header-title">Основное окно</h1>
            </div>
            <div class="user-info">
                <span class="user-name" id="user-name-display"></span>
                <button class="user-role-btn" id="user-role">Пользователь</button>
                <button id="logout-btn" class="user-role-btn">Выйти</button>
            </div>
        </div>

        <!-- Новая панель управления -->
        <div class="top-controls-panel">
            <div class="tabs-wrapper">
                <button class="tabs-scroll-btn left">‹</button>
                <div class="tabs-container" id="tabs-container">
                    <!-- Вкладки будут добавляться здесь динамически -->
                </div>
                <button class="tabs-scroll-btn right">›</button>
            </div>

            <div class="controls-group">
                <button class="new-tab-btn admin-only" id="new-tab-btn" title="Создать новую вкладку с таблицей">
                    <span class="icon">+</span> Новое окно
                </button>
                
                <div class="search-container">
                    <input type="text" class="search-input" id="table-search" placeholder="Поиск по таблице..." title="Поиск по всем данным таблицы">
                    <button class="search-clear" id="search-clear" title="Очистить поиск">×</button>
                </div>

                <button class="filter-selected-btn" id="filter-selected-btn" title="Показать только выделенные строки">
                    <span class="icon">⌕</span> Фильтр выделенного
                </button>
                
                <!-- Кнопка импорта Excel теперь только для администратора -->
                <button class="import-excel-btn admin-only" id="import-excel-btn" title="Импорт данных из Excel файла">
                    <span class="icon">↓</span> Импорт Excel
                </button>
                
                <button class="export-excel-btn" id="export-excel-btn" title="Экспорт данных в Excel файл">
                    <span class="icon">↑</span> Экспорт в Excel
                </button>
            </div>
        </div>

        <div class="container">
            <div class="sidebar">
                <div class="sidebar-buttons">
                    <button id="show-all" title="Показать все столбцы">Отобразить все</button>
                    <div id="custom-buttons"></div>
                </div>
                <div class="sidebar-bottom">
                    <div class="admin-only">
                        <button id="add-button" class="add-custom-button-btn" title="Добавить пользовательскую кнопку для отображения столбцов">
                            <span class="icon">+</span> Добавить кнопку
                        </button>
                    </div>
                    <!-- Кнопка "Добавить строку" теперь видна для пользователей, но очень маленькая -->
                    <button id="add-row-btn" class="add-row-btn" title="Добавить новую строку в таблицу">
                        <span class="icon">+</span> Добавить строку
                    </button>
                    <button id="check-dates-btn" class="check-dates-btn" title="Проверить все даты на истечение срока">
                        <span class="icon">📅</span> Проверка дат
                    </button>
                    <!-- НОВАЯ КНОПКА СИНХРОНИЗАЦИИ -->
                    <button id="github-sync-btn" class="github-sync-btn" title="Синхронизировать данные между устройствами">
                        <span class="icon">🔄</span> Синхронизировать
                    </button>
                    <div class="admin-only">
                        <button id="manage-users" class="manage-users-btn" title="Управление пользователями системы">
                            <span class="icon">👥</span> Управление пользователями
                        </button>
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="table-container">
                    <table id="data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" class="select-all-checkbox" id="select-all-checkbox" title="Показать все строки"></th>
                                <th>№ п/п</th>
                                <th>Название</th>
                                <th>Дата создания</th>
                                <th>Статус</th>
                                <th class="admin-only actions-header">
                                    <div class="th-content">
                                        <div class="th-main">
                                            <div class="th-title">×</div>
                                            <div class="filter-controls">
                                                <!-- Пусто - для выравнивания с другими заголовками -->
                                            </div>
                                        </div>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="checkbox" class="row-checkbox" data-row-id="1" title="Выделить строку"></td>
                                <td>1</td>
                                <td class="editable" title="Клик для редактирования">Проект А</td>
                                <td class="editable date-cell" title="Клик - открыть календарь. Двойной клик - ввести дату вручную">01.10.2023</td>
                                <td class="editable" title="Клик для редактирования">Активен</td>
                                <td class="admin-only">
                                    <button class="delete-row-btn" title="Удалить строку">×</button>
                                </td>
                            </tr>
                            <tr>
                                <td><input type="checkbox" class="row-checkbox" data-row-id="2" title="Выделить строку"></td>
                                <td>2</td>
                                <td class="editable" title="Клик для редактирования">Проект Б</td>
                                <td class="editable date-cell" title="Клик - открыть календарь. Двойной клик - ввести дату вручную">05.10.2023</td>
                                <td class="editable" title="Клик для редактирования">Завершен</td>
                                <td class="admin-only">
                                    <button class="delete-row-btn" title="Удалить строку">×</button>
                                </td>
                            </tr>
                            <tr>
                                <td><input type="checkbox" class="row-checkbox" data-row-id="3" title="Выделить строку"></td>
                                <td>3</td>
                                <td class="editable" title="Клик для редактирования">Проект В</td>
                                <td class="editable date-cell" title="Клик - открыть календарь. Двойной клик - ввести дату вручную">10.10.2023</td>
                                <td class="editable" title="Клик для редактирования">В процессе</td>
                                <td class="admin-only">
                                    <button class="delete-row-btn" title="Удалить строку">×</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Кнопки управления столбцами - теперь отображаются и у пользователей, но в уменьшенном виде -->
        <div class="column-controls">
            <button class="column-control-btn" id="add-column-btn" title="Добавить столбец">+</button>
            <button class="column-control-btn" id="remove-column-btn" title="Удалить столбец">-</button>
        </div>

        <!-- Настройки фиксированных столбцов - только для администратора -->
        <div class="fixed-columns-setting admin-only">
            <label>Фикс. столбцов: <input type="number" id="fixed-columns-count" min="1" max="10" value="3" title="Количество фиксированных столбцов слева"></label>
        </div>

        <!-- Индикатор статуса синхронизации -->
        <div id="sync-status" class="sync-status"></div>
    </div>

    <!-- Модальное окно для добавления кнопки -->
    <div id="add-button-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Добавить новую кнопку</h3>
                <span class="close">&times;</span>
            </div>
            <form id="add-button-form">
                <div class="form-group">
                    <label for="button-name">Название кнопки</label>
                    <input type="text" id="button-name" required title="Название кнопки, которое будет отображаться в боковой панели">
                </div>
                <div class="form-group">
                    <label for="column-count">Количество столбцов</label>
                    <input type="number" id="column-count" min="1" max="10" value="1" required title="Количество столбцов, которые будут отображаться при нажатии на кнопку">
                </div>
                <div id="columns-container">
                    <!-- Динамически добавляемые поля для названий столбцов -->
                </div>
                <div class="form-group">
                    <label>Проверка дат для столбцов:</label>
                    <div id="date-validation-columns">
                        <!-- Динамически добавляемые checkbox для каждого столбца -->
                    </div>
                </div>
                <button type="submit">Добавить кнопку</button>
            </form>
        </div>
    </div>

    <!-- Модальное окно управления пользователями -->
    <div id="users-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Управление пользователями</h3>
                <span class="close">&times;</span>
            </div>
            <form id="add-user-form">
                <div class="form-group">
                    <label for="new-username">Имя пользователя</label>
                    <input type="text" id="new-username" required title="Уникальное имя пользователя для входа в систему">
                </div>
                <div class="form-group">
                    <label for="new-password">Пароль</label>
                    <input type="password" id="new-password" required title="Пароль для входа в систему">
                </div>
                <div class="form-group">
                    <label for="new-role">Роль</label>
                    <select id="new-role" required title="Роль пользователя определяет доступные функции">
                        <option value="user">Пользователь</option>
                        <option value="admin">Администратор</option>
                    </select>
                </div>
                <button type="submit">Добавить пользователя</button>
            </form>
            <div class="user-list" id="users-list">
                <!-- Список пользователей будет здесь -->
            </div>
        </div>
    </div>

    <!-- Модальное окно для редактирования ячейки -->
    <div id="edit-cell-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="edit-cell-title">Редактирование ячейки</h3>
                <span class="close">&times;</span>
            </div>
            <div class="form-group">
                <label for="cell-value">Значение:</label>
                <textarea id="cell-value" class="edit-cell-content" title="Введите новое значение для ячейки"></textarea>
            </div>
            <div class="form-group">
                <label>Прикрепленные файлы:</label>
                <div class="file-upload-area" id="file-upload-area" title="Перетащите файлы сюда или кликните для выбора">
                    Перетащите файлы сюда или кликните для выбора<br>
                    <small>(изображения, PDF, Word, Excel)</small>
                    <input type="file" id="file-input" multiple style="display: none;" 
                           accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt">
                </div>
                <div class="attached-files" id="attached-files">
                    <!-- Прикрепленные файлы будут здесь -->
                </div>
            </div>
            <button id="save-cell-btn" title="Сохранить изменения в ячейке">Сохранить</button>
        </div>
    </div>

    <!-- Модальное окно предпросмотра файлов -->
    <div id="file-preview-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="preview-title">Просмотр файла</h3>
                <span class="close">&times;</span>
            </div>
            <div class="file-info">
                <strong id="preview-filename">Название файла</strong>
                <div id="preview-filetype" style="font-size: 0.9rem; color: #bdc3c7;"></div>
            </div>
            <div class="preview-content" id="preview-content">
                <!-- Контент файла будет здесь -->
            </div>
            <div class="preview-actions">
                <button id="download-preview-btn" class="btn-success" title="Скачать файл на компьютер">
                    <span class="icon">↓</span> Сохранить
                </button>
                <button id="copy-preview-btn" class="btn-secondary" title="Скопировать файл в буфер обмена (для изображений)">
                    <span class="icon">📋</span> Копировать
                </button>
                <button id="print-preview-btn" class="btn-secondary" title="Распечатать файл">
                    <span class="icon">🖨</span> Печать
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно импорта Excel -->
    <div id="import-excel-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Импорт данных из Excel</h3>
                <span class="close">&times;</span>
            </div>
            <div class="form-group">
                <label>Выберите файл Excel (.xlsx, .xls, .csv):</label>
                <div class="file-upload-area" id="excel-upload-area" title="Перетащите файл Excel сюда или кликните для выбора">
                    Перетащите файл Excel сюда или кликните для выбора<br>
                    <small>Поддерживаемые форматы: .xlsx, .xls, .csv</small>
                    <input type="file" id="excel-file-input" style="display: none;" 
                           accept=".xlsx,.xls,.csv">
                </div>
            </div>
            <div class="form-group">
                <label for="import-mode">Режим импорта:</label>
                <select id="import-mode" title="Выберите способ добавления данных">
                    <option value="replace">Заменить все данные</option>
                    <option value="append">Добавить к существующим</option>
                </select>
            </div>
            <div id="import-preview" style="display: none; margin-top: 1rem;">
                <h4>Предпросмотр данных:</h4>
                <div class="table-container" style="max-height: 300px;">
                    <table id="import-preview-table">
                        <!-- Предпросмотр данных будет здесь -->
                    </table>
                </div>
            </div>
            <div class="preview-actions">
                <button id="confirm-import-btn" class="btn-success" style="display: none;" title="Импортировать данные в таблицу">
                    <span class="icon">↓</span> Импортировать данные
                </button>
                <button id="cancel-import-btn" class="btn-secondary" title="Отменить импорт">
                    <span class="icon">×</span> Отмена
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно для удаления столбца -->
    <div id="remove-column-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Удаление столбца</h3>
                <span class="close">&times;</span>
            </div>
            <div class="form-group">
                <label for="column-to-remove">Выберите столбец для удаления:</label>
                <select id="column-to-remove" style="width: 100%; padding: 0.5rem; border: 1px solid #4a4a4a; border-radius: 5px; background: #2f2f2f; color: #ecf0f1;">
                    <!-- Столбцы будут добавлены динамически -->
                </select>
            </div>
            <button id="confirm-remove-column">Удалить столбец</button>
        </div>
    </div>

    <!-- Модальное окно управления синхронизацией -->
    <div id="github-sync-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Синхронизация данных</h3>
                <span class="close">&times;</span>
            </div>
            <div class="form-group">
                <label for="github-token">GitHub Personal Access Token:</label>
                <input type="password" id="github-token" placeholder="Введите ваш токен" style="width: 100%; padding: 0.9rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary);">
                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">
                    Для работы синхронизации необходим GitHub Personal Access Token с правами "repo"
                </small>
            </div>
            <div class="form-group" style="display: flex; gap: 10px;">
                <button id="save-token-btn" style="flex: 1;">Сохранить токен</button>
                <button id="remove-token-btn" style="flex: 1; background: var(--bg-tertiary);">Удалить токен</button>
            </div>
            <div class="form-group" style="display: flex; gap: 10px;">
                <button id="force-save-btn" style="flex: 1; background: var(--accent-color);">Принудительно сохранить</button>
                <button id="force-load-btn" style="flex: 1; background: var(--accent-color);">Принудительно загрузить</button>
            </div>
            <div class="form-group">
                <div id="sync-info" style="padding: 10px; background: var(--bg-primary); border-radius: 5px; font-size: 0.9rem; color: var(--text-secondary);">
                    Статус: <span id="sync-status-text">Не настроено</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Скрытый input для загрузки логотипа -->
    <input type="file" id="logo-upload" accept=".png" style="display: none;">

    <!-- Подключаем библиотеку для работы с Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // GitHub Storage System
        class GitHubStorage {
            constructor() {
                this.owner = 'viktor15081985';
                this.repo = 'Transort';
                this.branch = 'main';
                this.dataFile = 'transport-data.json';
                this.token = null;
            }

            async init() {
                this.token = localStorage.getItem('github_token');
                if (!this.token) {
                    return null;
                }
                return this.loadData();
            }

            async requestToken() {
                return new Promise((resolve) => {
                    const token = prompt(
                        'ВВЕДИТЕ ВАШ GITHUB ТОКЕН:\n\n' +
                        'Это нужно для синхронизации данных между устройствами.\n' +
                        'Токен будет сохранен в вашем браузере.',
                        ''
                    );
                    
                    if (token && token.trim()) {
                        this.token = token.trim();
                        localStorage.setItem('github_token', this.token);
                        this.showMessage('✅ Токен сохранен!', 'success');
                        resolve();
                    } else {
                        this.showMessage('❌ Токен обязателен для работы', 'error');
                        resolve();
                    }
                });
            }

            async makeGitHubRequest(url, options = {}) {
                if (!this.token) throw new Error('No token');

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${this.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    ...options
                });

                if (response.status === 401) {
                    localStorage.removeItem('github_token');
                    this.token = null;
                    throw new Error('Invalid token');
                }
                
                if (!response.ok) throw new Error(`Error: ${response.status}`);
                return response.json();
            }

            async getFileSHA() {
                try {
                    const url = `https://api.github.com/repos/${this.owner}/${this.repo}/contents/${this.dataFile}`;
                    const fileInfo = await this.makeGitHubRequest(url);
                    return fileInfo.sha;
                } catch (error) {
                    return null;
                }
            }

            async loadData() {
                if (this.token) {
                    try {
                        const data = await this.loadFromGitHub();
                        this.saveToLocalStorage(data);
                        this.showMessage('✅ Данные загружены из облака', 'success');
                        return data;
                    } catch (error) {
                        console.warn('Cloud load failed:', error);
                    }
                }
                return this.loadFromLocalStorage();
            }

            async loadFromGitHub() {
                try {
                    const url = `https://api.github.com/repos/${this.owner}/${this.repo}/contents/${this.dataFile}`;
                    const fileInfo = await this.makeGitHubRequest(url);
                    const content = atob(fileInfo.content);
                    return JSON.parse(content);
                } catch (error) {
                    if (error.message.includes('404')) {
                        return this.getDefaultData();
                    }
                    throw error;
                }
            }

            async saveData(data) {
                this.saveToLocalStorage(data);
                
                if (this.token) {
                    try {
                        await this.saveToGitHub(data);
                        this.showMessage('✅ Данные сохранены в облако', 'success');
                    } catch (error) {
                        this.showMessage('⚠️ Данные сохранены локально', 'warning');
                    }
                } else {
                    this.showMessage('💾 Данные сохранены локально', 'info');
                }
            }

            async saveToGitHub(data) {
                const sha = await this.getFileSHA();
                const content = btoa(JSON.stringify(data, null, 2));
                
                const url = `https://api.github.com/repos/${this.owner}/${this.repo}/contents/${this.dataFile}`;
                const method = sha ? 'PUT' : 'POST';
                
                const body = {
                    message: `Update: ${new Date().toLocaleString('ru-RU')}`,
                    content: content,
                    branch: this.branch
                };
                
                if (sha) body.sha = sha;
                
                await this.makeGitHubRequest(url, {
                    method: method,
                    body: JSON.stringify(body)
                });
            }

            saveToLocalStorage(data) {
                localStorage.setItem('transport_data', JSON.stringify(data));
                localStorage.setItem('last_save', new Date().toISOString());
            }

            loadFromLocalStorage() {
                const stored = localStorage.getItem('transport_data');
                if (stored) {
                    this.showMessage('📱 Данные загружены локально', 'info');
                    return JSON.parse(stored);
                }
                return this.getDefaultData();
            }

            getDefaultData() {
                return {
                    vehicles: [],
                    drivers: [],
                    routes: [],
                    lastUpdate: new Date().toISOString()
                };
            }

            showMessage(message, type = 'info') {
                const statusElement = document.getElementById('sync-status');
                const statusText = document.getElementById('sync-status-text');
                
                if (statusElement && statusText) {
                    statusElement.className = `sync-status ${type}`;
                    statusElement.textContent = message;
                    statusText.textContent = message;
                    
                    setTimeout(() => {
                        statusElement.style.display = 'none';
                    }, 3000);
                }
                
                console.log(message);
            }

            async forceSync() {
                if (!this.token) {
                    await this.requestToken();
                }
                
                try {
                    const cloudData = await this.loadFromGitHub();
                    const localData = this.loadFromLocalStorage();
                    
                    const cloudTime = new Date(cloudData.lastUpdate);
                    const localTime = new Date(localData.lastUpdate);
                    
                    if (cloudTime > localTime) {
                        this.saveToLocalStorage(cloudData);
                        this.showMessage('✅ Синхронизировано с облаком', 'success');
                        return cloudData;
                    } else if (localTime > cloudTime) {
                        await this.saveToGitHub(localData);
                        this.showMessage('✅ Локальные данные загружены в облако', 'success');
                        return localData;
                    } else {
                        this.showMessage('✅ Данные актуальны', 'info');
                        return localData;
                    }
                } catch (error) {
                    this.showMessage('❌ Ошибка синхронизации', 'error');
                }
            }

            setToken(token) {
                this.token = token;
                localStorage.setItem('github_token', token);
                this.showMessage('✅ Токен сохранен', 'success');
            }

            removeToken() {
                this.token = null;
                localStorage.removeItem('github_token');
                this.showMessage('🗑️ Токен удален', 'info');
            }
        }

        // Основное приложение
        const githubStorage = new GitHubStorage();

        // Данные пользователей
        let users = JSON.parse(localStorage.getItem('users')) || [
            { username: 'admin', password: 'admin', role: 'admin' },
            { username: 'user', password: 'user', role: 'user' }
        ];

        // Данные таблицы
        let tableData = JSON.parse(localStorage.getItem('tableData')) || [
            { id: 1, name: 'Проект А', date: '01.10.2023', status: 'Активен', customData: {}, attachments: {} },
            { id: 2, name: 'Проект Б', date: '05.10.2023', status: 'Завершен', customData: {}, attachments: {} },
            { id: 3, name: 'Проект В', date: '10.10.2023', status: 'В процессе', customData: {}, attachments: {} }
        ];

        // Настройки приложения
        let appSettings = JSON.parse(localStorage.getItem('appSettings')) || {
            headerTitle: 'Основное окно',
            headerLogo: '',
            fixedColumnsCount: 3,
            currentTheme: 'theme-orange'
        };

        // Данные кнопок и столбцов
        let customButtons = JSON.parse(localStorage.getItem('customButtons')) || [];
        let customColumns = JSON.parse(localStorage.getItem('customColumns')) || [];

        // Базовые столбцы
        let basicColumns = JSON.parse(localStorage.getItem('basicColumns')) || [
            { id: 'id', name: '№ п/п', editable: false },
            { id: 'name', name: 'Название', editable: true },
            { id: 'date', name: 'Дата создания', editable: true },
            { id: 'status', name: 'Статус', editable: true }
        ];

        // Настройки проверки дат
        let dateValidationColumns = JSON.parse(localStorage.getItem('dateValidationColumns')) || {};

        // Текущий пользователь и состояние
        let currentUser = null;
        let currentEditingCell = null;
        let isEditingHeader = false;
        let currentPreviewFile = null;
        let currentSort = { column: null, direction: 'asc' };
        let currentFilters = {};
        let currentDatePicker = null;
        let currentDateInput = null;

        // Новые переменные для вкладок и поиска
        let tabs = JSON.parse(localStorage.getItem('tabs')) || [
            { id: 'tab1', name: 'Основное окно', data: null }
        ];
        let currentTabId = 'tab1';
        let selectedRows = new Set();
        let searchTerm = '';

        // Данные для импорта
        let currentImportData = null;

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            setupEventListeners();
            // Загружаем данные из GitHub если есть токен
            await githubStorage.init();
            loadAppSettings();
            renderTabs();
        }

        function setupEventListeners() {
            // Логин
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            document.getElementById('logout-btn').addEventListener('click', handleLogout);

            // Основные кнопки
            document.getElementById('show-all').addEventListener('click', showAllColumns);
            document.getElementById('add-button').addEventListener('click', () => showModal('add-button-modal'));
            document.getElementById('manage-users').addEventListener('click', () => showModal('users-modal'));
            document.getElementById('check-dates-btn').addEventListener('click', checkAllDates);
            document.getElementById('add-row-btn').addEventListener('click', addNewRow);

            // Кнопки синхронизации
            document.getElementById('github-sync-btn').addEventListener('click', () => showModal('github-sync-modal'));
            document.getElementById('save-token-btn').addEventListener('click', saveGitHubToken);
            document.getElementById('remove-token-btn').addEventListener('click', removeGitHubToken);
            document.getElementById('force-save-btn').addEventListener('click', forceSaveToGitHub);
            document.getElementById('force-load-btn').addEventListener('click', forceLoadFromGitHub);

            // Новые кнопки управления
            document.getElementById('new-tab-btn').addEventListener('click', createNewTab);
            document.getElementById('filter-selected-btn').addEventListener('click', filterSelectedRows);
            document.getElementById('export-excel-btn').addEventListener('click', exportToExcel);
            document.getElementById('import-excel-btn').addEventListener('click', () => showModal('import-excel-modal'));
            document.getElementById('table-search').addEventListener('input', handleSearch);
            document.getElementById('search-clear').addEventListener('click', clearSearch);
            document.getElementById('select-all-checkbox').addEventListener('change', handleSelectAll);

            // Кнопки прокрутки вкладок
            document.querySelector('.tabs-scroll-btn.left').addEventListener('click', scrollTabsLeft);
            document.querySelector('.tabs-scroll-btn.right').addEventListener('click', scrollTabsRight);

            // Кнопки управления столбцами
            document.getElementById('add-column-btn').addEventListener('click', addNewColumn);
            document.getElementById('remove-column-btn').addEventListener('click', showRemoveColumnModal);
            document.getElementById('fixed-columns-count').addEventListener('change', updateFixedColumnsCount);

            // Удаление столбца
            document.getElementById('confirm-remove-column').addEventListener('click', removeSelectedColumn);

            // Импорт Excel
            document.getElementById('excel-upload-area').addEventListener('click', function() {
                document.getElementById('excel-file-input').click();
            });
            document.getElementById('excel-file-input').addEventListener('change', handleExcelFileSelect);
            document.getElementById('confirm-import-btn').addEventListener('click', confirmImport);
            document.getElementById('cancel-import-btn').addEventListener('click', () => {
                document.getElementById('import-excel-modal').style.display = 'none';
            });

            // Модальные окна
            document.querySelectorAll('.close').forEach(close => {
                close.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });

            // Формы
            document.getElementById('add-button-form').addEventListener('submit', handleAddButton);
            document.getElementById('add-user-form').addEventListener('submit', handleAddUser);
            document.getElementById('column-count').addEventListener('change', generateColumnInputs);
            document.getElementById('save-cell-btn').addEventListener('click', saveCellChanges);

            // Кнопки предпросмотра
            document.getElementById('download-preview-btn').addEventListener('click', downloadPreviewFile);
            document.getElementById('copy-preview-btn').addEventListener('click', copyPreviewFile);
            document.getElementById('print-preview-btn').addEventListener('click', printPreviewFile);

            // Работа с файлами
            const fileUploadArea = document.getElementById('file-upload-area');
            const fileInput = document.getElementById('file-input');
            
            fileUploadArea.addEventListener('click', function() {
                fileInput.click();
            });

            fileInput.addEventListener('change', function(e) {
                handleFileUpload(e.target.files);
            });

            setupFileDropZone();

            // Логотип
            document.getElementById('header-logo').addEventListener('click', triggerLogoUpload);
            document.getElementById('logo-upload').addEventListener('change', handleLogoUpload);

            // Закрытие фильтров при клике вне их
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.filter-dropdown') && !e.target.closest('.filter-btn')) {
                    closeAllFilterDropdowns();
                }
                if (!e.target.closest('.date-picker') && !e.target.classList.contains('date-cell')) {
                    closeDatePicker();
                }
                if (!e.target.closest('.date-input-overlay') && currentDateInput) {
                    closeDateInput();
                }
            });

            // Исправление проблемы с прокруткой фильтра
            document.addEventListener('mousedown', function(e) {
                if (e.target.closest('.filter-options')) {
                    e.stopPropagation();
                }
            });
        }

        // ФУНКЦИИ СИНХРОНИЗАЦИИ
        async function saveGitHubToken() {
            const token = document.getElementById('github-token').value.trim();
            if (token) {
                githubStorage.setToken(token);
                document.getElementById('github-sync-modal').style.display = 'none';
            } else {
                alert('Введите токен');
            }
        }

        function removeGitHubToken() {
            githubStorage.removeToken();
            document.getElementById('github-token').value = '';
        }

        async function forceSaveToGitHub() {
            const allData = {
                tableData,
                customButtons,
                customColumns,
                dateValidationColumns,
                tabs,
                appSettings,
                users,
                lastUpdate: new Date().toISOString()
            };
            
            await githubStorage.saveData(allData);
        }

        async function forceLoadFromGitHub() {
            const data = await githubStorage.forceSync();
            if (data) {
                // Обновляем все данные из облака
                tableData = data.tableData || tableData;
                customButtons = data.customButtons || customButtons;
                customColumns = data.customColumns || customColumns;
                dateValidationColumns = data.dateValidationColumns || dateValidationColumns;
                tabs = data.tabs || tabs;
                appSettings = data.appSettings || appSettings;
                users = data.users || users;

                // Сохраняем в localStorage
                saveAllData();
                
                // Перерисовываем интерфейс
                renderTabs();
                renderTable();
                loadCustomButtons();
                loadAppSettings();
            }
        }

        function saveAllData() {
            localStorage.setItem('tableData', JSON.stringify(tableData));
            localStorage.setItem('customButtons', JSON.stringify(customButtons));
            localStorage.setItem('customColumns', JSON.stringify(customColumns));
            localStorage.setItem('dateValidationColumns', JSON.stringify(dateValidationColumns));
            localStorage.setItem('tabs', JSON.stringify(tabs));
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            localStorage.setItem('users', JSON.stringify(users));
        }

        // ОСТАЛЬНЫЕ ФУНКЦИИ ВАШЕГО ПРИЛОЖЕНИЯ ОСТАЮТСЯ БЕЗ ИЗМЕНЕНИЙ
        // (все функции из вашего оригинального кода)

        // ... остальной код вашего приложения ...

        // В КОНЦЕ СКРИПТА ДОБАВЬТЕ:
        // Автоматически сохраняем данные при изменении
        function autoSave() {
            saveAllData();
            
            // Если есть токен GitHub, сохраняем и в облако
            if (githubStorage.token) {
                const allData = {
                    tableData,
                    customButtons,
                    customColumns,
                    dateValidationColumns,
                    tabs,
                    appSettings,
                    users,
                    lastUpdate: new Date().toISOString()
                };
                
                githubStorage.saveData(allData).catch(error => {
                    console.warn('Auto-save to GitHub failed:', error);
                });
            }
        }

        // Вызываем autoSave при различных событиях
        function setupAutoSave() {
            // Сохраняем при изменении данных таблицы
            const originalDeleteRow = window.deleteRow;
            window.deleteRow = function(rowId) {
                originalDeleteRow(rowId);
                autoSave();
            };

            // Сохраняем при добавлении строки
            const originalAddNewRow = window.addNewRow;
            window.addNewRow = function() {
                originalAddNewRow();
                autoSave();
            };

            // Сохраняем при редактировании ячейки
            const originalSaveCellChanges = window.saveCellChanges;
            window.saveCellChanges = function() {
                originalSaveCellChanges();
                autoSave();
            };

            // Добавьте аналогичные перехватчики для других функций, изменяющих данные
        }

        // Инициализируем автосохранение после загрузки
        setTimeout(setupAutoSave, 1000);
    </script>
</body>
</html>
